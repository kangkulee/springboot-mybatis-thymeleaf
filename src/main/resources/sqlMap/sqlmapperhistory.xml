<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pro.cntech.car.mapper.HistoryMapper">
	
	<select id="getHistoryList" resultType="pro.cntech.car.vo.HistoryVO" parameterType ="pro.cntech.car.vo.HistoryVO">
		SELECT
			ci.car_srl AS carSrl,
			ci.car_number AS carNumber,
			ci.car_type AS carType,
			di.driver_name AS driverName,
			COALESCE(TO_CHAR(cdi.driving_end_at,'YYYY.MM.dd'), '데이터없음') AS drivingEndAT,
			di.driver_dept AS driverDept,
			ei.euid AS euid,
			ei.eu_battery AS euBattery
		FROM car_info AS ci
		INNER JOIN driver_info AS di
			ON ci.driver_srl = di.driver_srl
		INNER JOIN car_driving_info AS cdi
			ON ci.car_srl = cdi.car_srl
		INNER join euid_info AS ei
			ON ci.euid_srl = ei.euid_srl
		<if test='column != null'>
			WHERE upper(${column}) LIKE '%${search}%'
		</if>
	</select>

	<select id="getTotalHistory" resultType="integer" parameterType="pro.cntech.car.vo.HistoryVO">
		SELECT
			COUNT(ci.car_srl)
		FROM car_info AS ci
		INNER JOIN driver_info AS di
			ON ci.driver_srl = di.driver_srl
		INNER JOIN car_driving_info AS cdi
			ON ci.car_srl = cdi.car_srl
		INNER join euid_info AS ei
			ON ci.euid_srl = ei.euid_srl
		<if test='column != null'>
			WHERE upper(${column}) LIKE '%${search}%'
		</if>
    </select>
    
    <select id="getSearchHistoryList" resultType="pro.cntech.car.vo.HistoryVO" parameterType="pro.cntech.car.vo.HistoryVO">
    	SELECT
			ci.car_srl AS carSrl,
			ci.car_number AS carNumber,
			ci.car_type AS carType,
			di.driver_name AS driverName,
			to_char(cdi.driving_end_at,'YYYY.MM.dd') as drivingEndAT,
			di.driver_dept AS driverDept,
			ei.euid AS euid,
			ei.eu_battery AS euBattery
		FROM car_info as ci
		INNER JOIN driver_info AS di
			ON ci.driver_srl = di.driver_srl
		INNER JOIN car_driving_info AS cdi
			ON di.driver_srl = cdi.driver_srl
		INNER join euid_info AS ei
			ON ci.euid_srl = ei.euid_srl
    </select>

</mapper>